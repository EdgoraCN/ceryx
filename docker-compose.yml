version: '3.5'

services:
  ceryx:
    image: sourcelair/ceryx:0.6.1
    ports:
      - ${CERYX_EXTERNAL_PORT:-80}:80
      - ${CERYX_EXTERNAL_SSL_PORT:-443}:443
    environment:
      CERYX_REDIS_HOST: ${CERYX_REDIS_HOST:-redis}
      CERYX_REDIS_PORT: ${CERYX_REDIS_PORT:-6379}
      CERYX_SSL_DEFAULT_CERTIFICATE: /run/secrets/public-urls.crt
      CERYX_SSL_DEFAULT_KEY: /run/secrets/public-urls.key
      CERYX_DISABLE_LETS_ENCRYPT: 'true'
    secrets:
      - public-urls.crt
      - public-urls.key
      - studio.developer.nbg.gr.crt
      - studio.developer.nbg.gr.key

  api:
    image: sourcelair/ceryx-api:latest
    environment:
      CERYX_REDIS_HOST: ${CERYX_REDIS_HOST:-redis}
      CERYX_REDIS_PORT: ${CERYX_REDIS_PORT:-6379}
      CERYX_API_HOST: ${CERYX_API_HOST:-0.0.0.0}
      CERYX_API_PORT: ${CERYX_API_PORT:-5555}
      CERYX_API_HOSTNAME: ${CERYX_API_HOSTNAME:-localhost}
      CERYX_DEBUG: ${CERYX_DEBUG:-false}

  redis:
    image: redis:3.2.11-alpine
    command: redis-server --appendonly yes
    volumes:
      - redis_data:/data

networks:
  default:
    attachable: true
    driver: overlay

secrets:
  public-urls.crt:
    name: ceryx-public-urls-bundle-v2
    external: true
  public-urls.key:
    name: ceryx-public-urls-key-v2
    external: true
  studio.developer.nbg.gr.crt:
    external: true
    name: ceryx-web-bundle-v1
  studio.developer.nbg.gr.key:
    external: true
    name: ceryx-web-key-v1

volumes:
  redis_data:

